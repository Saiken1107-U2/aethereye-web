<section class="max-w-6xl mx-auto p-6">
  <h2 class="text-3xl font-bold mb-6">Comentarios de Clientes</h2>

  <div class="bg-white rounded shadow overflow-hidden">
    <table class="w-full">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-3 text-left">Producto</th>
          <th class="p-3 text-left">Cliente</th>
          <th class="p-3 text-left">Comentario</th>
          <th class="p-3 text-left">Calificación</th>
          <th class="p-3 text-left">Fecha</th>
          <th class="p-3 text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        @if (comentarios.length > 0) {
          @for (comentario of comentarios; track comentario.id) {
            <tr class="border-t hover:bg-gray-50">
              <td class="p-3">{{ comentario.producto }}</td>
              <td class="p-3">{{ comentario.cliente }}</td>
              <td class="p-3 max-w-xs truncate">{{ comentario.contenido }}</td>
              <td class="p-3">
                <div class="flex items-center">
                  @for (star of getStars(5); track $index) {
                    <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                  }
                  <span class="ml-1 text-sm text-gray-600">(5)</span>
                </div>
              </td>
              <td class="p-3">{{ comentario.fecha | date:'shortDate' }}</td>
              <td class="p-3 text-center">
                <div class="flex justify-center space-x-2">
                  <button 
                    (click)="verDetalle(comentario.id)"
                    class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition"
                  >
                    Ver Detalle
                  </button>
                  <button 
                    (click)="eliminar(comentario.id)" 
                    class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition"
                  >
                    Eliminar
                  </button>
                </div>
              </td>
            </tr>
          }
        } @else {
          <tr>
            <td colspan="6" class="p-8 text-center text-gray-500">
              No hay comentarios registrados
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</section>

<!-- Modal de Detalle de Comentario -->
@if (mostrarModal && comentarioDetalle) {
  <div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
      <!-- Header del Modal -->
      <div class="flex justify-between items-center pb-3 border-b">
        <h3 class="text-lg font-semibold text-gray-900">Detalle del Comentario</h3>
        <button 
          (click)="cerrarModal()"
          class="text-gray-400 hover:text-gray-600"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Contenido del Modal -->
      <div class="mt-4 space-y-6">
        <!-- Información del Cliente -->
        <div class="bg-blue-50 rounded-lg p-4">
          <h4 class="text-md font-semibold text-gray-900 mb-3">Información del Cliente</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div>
              <span class="font-medium text-gray-700">Nombre:</span>
              <span class="ml-1 text-gray-900">{{ comentarioDetalle.cliente_detalle.nombre }}</span>
            </div>
            <div>
              <span class="font-medium text-gray-700">Correo:</span>
              <span class="ml-1 text-gray-900">{{ comentarioDetalle.cliente_detalle.correo }}</span>
            </div>
          </div>
        </div>

        <!-- Información del Producto -->
        <div class="bg-green-50 rounded-lg p-4">
          <h4 class="text-md font-semibold text-gray-900 mb-3">Producto Comentado</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div>
              <span class="font-medium text-gray-700">Producto:</span>
              <span class="ml-1 text-gray-900">{{ comentarioDetalle.producto_detalle.nombre }}</span>
            </div>
            <div>
              <span class="font-medium text-gray-700">Categoría:</span>
              <span class="ml-1 text-gray-900">{{ comentarioDetalle.producto_detalle.categoria }}</span>
            </div>
          </div>
        </div>

        <!-- Comentario y Calificación -->
        <div class="bg-yellow-50 rounded-lg p-4">
          <h4 class="text-md font-semibold text-gray-900 mb-3">Comentario y Calificación</h4>
          <div class="space-y-3">
            <!-- Calificación -->
            <div class="flex items-center space-x-2">
              <span class="font-medium text-gray-700">Calificación:</span>
              <div class="flex items-center">
                @for (star of getStars(comentarioDetalle.calificacion || 5); track $index) {
                  <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                  </svg>
                }
                <span class="ml-2 text-sm text-gray-600">({{ comentarioDetalle.calificacion || 5 }}/5)</span>
              </div>
            </div>
            
            <!-- Fecha -->
            <div>
              <span class="font-medium text-gray-700">Fecha del comentario:</span>
              <span class="ml-1 text-gray-900">{{ comentarioDetalle.fecha | date:'fullDate' }}</span>
            </div>
            
            <!-- Contenido del comentario -->
            <div>
              <span class="font-medium text-gray-700">Comentario:</span>
              <div class="mt-2 p-3 bg-white rounded border border-gray-200 text-gray-900">
                {{ comentarioDetalle.contenido }}
              </div>
            </div>
          </div>
        </div>

        <!-- Acciones del Modal -->
        <div class="flex justify-end space-x-3 pt-4 border-t">
          <button 
            (click)="cerrarModal()"
            class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 transition"
          >
            Cerrar
          </button>
          <button 
            (click)="eliminarComentario(comentarioDetalle.id)"
            class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition"
          >
            Eliminar
          </button>
        </div>
      </div>
    </div>
  </div>
}
