<div class="dashboard-container">
  <!-- Header del Dashboard -->
  <div class="dashboard-header">
    <h1 class="dashboard-title">Panel de Control - AetherEye</h1>
    <button 
      class="refresh-btn" 
      (click)="refreshData()" 
      [disabled]="loading"
      title="Actualizar datos">
      <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i>
      {{ loading ? 'Actualizando...' : 'Actualizar' }}
    </button>
  </div>

  <!-- Indicador de carga -->
  <div *ngIf="loading" class="loading-indicator">
    <i class="fas fa-spinner fa-spin"></i>
    <span>Cargando datos del dashboard...</span>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="error" class="error-message">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ error }}</span>
  </div>

  <!-- Contenido principal del dashboard -->
  <div *ngIf="!loading && !error" class="dashboard-content">
    
    <!-- Tarjetas de KPIs principales -->
    <div class="kpi-cards" *ngIf="stats">
      <div class="kpi-card kpi-primary">
        <div class="kpi-icon">
          <i class="fas fa-boxes"></i>
        </div>
        <div class="kpi-info">
          <h3>{{ stats.totalInsumos }}</h3>
          <p>Total Insumos</p>
        </div>
      </div>

      <div class="kpi-card kpi-success">
        <div class="kpi-icon">
          <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="kpi-info">
          <h3>{{ formatCurrency(stats.valorTotalInventario) }}</h3>
          <p>Valor Inventario</p>
        </div>
      </div>

      <div class="kpi-card kpi-warning">
        <div class="kpi-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="kpi-info">
          <h3>{{ stats.insumosStockBajo }}</h3>
          <p>Stock Bajo</p>
        </div>
      </div>

      <div class="kpi-card kpi-info">
        <div class="kpi-icon">
          <i class="fas fa-exchange-alt"></i>
        </div>
        <div class="kpi-info">
          <h3>{{ stats.movimientosHoy }}</h3>
          <p>Movimientos Hoy</p>
        </div>
      </div>

      <div class="kpi-card kpi-secondary">
        <div class="kpi-icon">
          <i class="fas fa-truck"></i>
        </div>
        <div class="kpi-info">
          <h3>{{ stats.totalProveedores }}</h3>
          <p>Proveedores Activos</p>
        </div>
      </div>
    </div>

    <!-- Gráficos y análisis -->
    <div class="charts-section">
      <!-- Stock por Categoría -->
      <div class="chart-card">
        <div class="chart-header">
          <h3><i class="fas fa-chart-pie"></i> Stock por Categoría</h3>
        </div>
        <div class="chart-content">
          <div *ngIf="stockByCategory.length > 0; else noStockData" class="category-list">
            <div *ngFor="let category of stockByCategory" class="category-item">
              <div class="category-name">{{ category.categoria }}</div>
              <div class="category-stats">
                <span class="category-count">{{ category.cantidad }} items</span>
                <span class="category-value">{{ formatCurrency(category.valorTotal) }}</span>
              </div>
            </div>
          </div>
          <ng-template #noStockData>
            <div class="no-data">
              <i class="fas fa-chart-pie"></i>
              <p>No hay datos de categorías disponibles</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Tendencia de Movimientos -->
      <div class="chart-card">
        <div class="chart-header">
          <h3><i class="fas fa-chart-line"></i> Movimientos (Últimos 7 días)</h3>
        </div>
        <div class="chart-content">
          <div *ngIf="movementTrend.length > 0; else noMovementData" class="movement-list">
            <div *ngFor="let movement of movementTrend" class="movement-item">
              <div class="movement-date">{{ formatDate(movement.fecha) }}</div>
              <div class="movement-stats">
                <span class="movement-entradas">
                  <i class="fas fa-arrow-up text-success"></i> {{ movement.entradas }}
                </span>
                <span class="movement-salidas">
                  <i class="fas fa-arrow-down text-danger"></i> {{ movement.salidas }}
                </span>
                <span class="movement-ajustes">
                  <i class="fas fa-edit text-warning"></i> {{ movement.ajustes }}
                </span>
              </div>
            </div>
          </div>
          <ng-template #noMovementData>
            <div class="no-data">
              <i class="fas fa-chart-line"></i>
              <p>No hay movimientos en los últimos 7 días</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>

    <!-- Alertas y Top Items -->
    <div class="alerts-section">
      <!-- Alertas de Stock Bajo -->
      <div class="alert-card">
        <div class="alert-header">
          <h3><i class="fas fa-exclamation-triangle"></i> Alertas de Stock Bajo</h3>
        </div>
        <div class="alert-content">
          <div *ngIf="lowStockAlerts.length > 0; else noAlerts" class="alert-list">
            <div *ngFor="let alert of lowStockAlerts" 
                 class="alert-item" 
                 [ngClass]="getUrgencyClass(alert.urgencia)">
              <div class="alert-info">
                <div class="alert-name">{{ alert.nombre }}</div>
                <div class="alert-category">{{ alert.categoria }}</div>
              </div>
              <div class="alert-stock">
                <span class="current-stock">{{ alert.stockActual }}</span>
                <span class="stock-separator">/</span>
                <span class="min-stock">{{ alert.stockMinimo }}</span>
                <span class="urgency-badge" [ngClass]="getUrgencyClass(alert.urgencia)">
                  {{ alert.urgencia }}
                </span>
              </div>
            </div>
          </div>
          <ng-template #noAlerts>
            <div class="no-data success">
              <i class="fas fa-check-circle"></i>
              <p>¡Todos los insumos tienen stock suficiente!</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Top Items Más Usados -->
      <div class="top-items-card">
        <div class="top-items-header">
          <h3><i class="fas fa-trophy"></i> Insumos Más Utilizados</h3>
        </div>
        <div class="top-items-content">
          <div *ngIf="topItems.length > 0; else noTopItems" class="top-items-list">
            <div *ngFor="let item of topItems; let i = index" class="top-item">
              <div class="rank">{{ i + 1 }}</div>
              <div class="item-info">
                <div class="item-name">{{ item.nombre }}</div>
                <div class="item-category">{{ item.categoria }}</div>
              </div>
              <div class="item-stats">
                <span class="movements">{{ item.totalMovimientos }} mov.</span>
                <span class="quantity">{{ item.cantidadTotal }} und.</span>
              </div>
            </div>
          </div>
          <ng-template #noTopItems>
            <div class="no-data">
              <i class="fas fa-trophy"></i>
              <p>No hay datos de movimientos disponibles</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>

    <!-- Footer con información de actualización -->
    <div class="dashboard-footer" *ngIf="stats">
      <p>
        <i class="fas fa-clock"></i>
        Última actualización: {{ formatDate(stats.fechaActualizacion) }}
      </p>
    </div>
  </div>
</div>
